(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{492:function(s,t,a){"use strict";a.r(t);var n=a(21),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("blockquote",[a("p",[s._v("基于 ext2 文件系统的理解")])]),s._v(" "),a("h3",{attrs:{id:"_1-一些结构体"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-一些结构体"}},[s._v("#")]),s._v(" 1. 一些结构体")]),s._v(" "),a("p",[s._v("在 Linux 系统下，一切皆文件，目录也不例外。 目录文件中存储的内容，就是一个个 "),a("code",[s._v("dir_entry")]),s._v(" 结构体。 每个结构体对应该目录下的一个文件，存储着文件的相关信息。在 ext2 文件系统中，它的结构入下：")]),s._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ext2_dir_entry_2")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    __u32 inode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* Inode number */")]),s._v("\n    __u16 rec_len"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* Directory entry length */")]),s._v("\n    __u8 name_len"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* Name length */")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("char")]),s._v(" name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("255")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* File name */")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("其中, 最重要的字段是 "),a("code",[s._v("inode")]),s._v(", 文件数据的存储位置等其他重要信息都存储在里面。inode 结构体内容复杂，对于理解链接来讲，下面的部分足够 :")]),s._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ext2_inode")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ...")]),s._v("\n    __u16 i_links_count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 有多少个 dir_entry 结构体引用了它")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ...")]),s._v("\n    __u32 i_block"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("EXT2_N_BLOCKS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 数据块指针数组，以此来找到文件的真正数据")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h3",{attrs:{id:"_2-一个实验"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-一个实验"}},[s._v("#")]),s._v(" 2. 一个实验")]),s._v(" "),a("p",[s._v("在 Linux 下创建软链接和硬链接")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("link")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("link")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" test.txt\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" test.txt hardtest1\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" test.txt hardtest2\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" -s test.txt softtest\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("使用 "),a("code",[s._v("ll -i")]),s._v(" 查看文件( -i 命令可以查看文件的 inode 编号)")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost link"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll -i")]),s._v("\n总用量 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18083458")]),s._v(" -rw-r--r--. "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" root root "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v("月 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("29")]),s._v(" 02:20 hardtest1\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18083458")]),s._v(" -rw-r--r--. "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" root root "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v("月 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("29")]),s._v(" 02:20 hardtest2\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18083459")]),s._v(" lrwxrwxrwx. "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v("月 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("29")]),s._v(" 02:20 softtest -"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" test.txt\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18083458")]),s._v(" -rw-r--r--. "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" root root "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v("月 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("29")]),s._v(" 02:20 test.txt\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("第一个字段是 inode 编号, 第三个字段是引用计数。"),a("br"),s._v("\nhardtest1、hardtest2、test.txt的 inode 编号都一样, 且引用计数刚好是3.说明硬链接和原文件共用了一个 inode。"),a("br"),s._v("\n软链接文件的内容是原文件的地址，可以通过 "),a("code",[s._v("readlink")]),s._v(" 命令查看软链接的内容。")]),s._v(" "),a("h3",{attrs:{id:"_3-一张图"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-一张图"}},[s._v("#")]),s._v(" 3. 一张图")]),s._v(" "),a("p",[a("img",{attrs:{src:"/images/linux/link.jpg",alt:"link"}})]),s._v(" "),a("h3",{attrs:{id:"_4-一些现象"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-一些现象"}},[s._v("#")]),s._v(" 4. 一些现象")]),s._v(" "),a("p",[s._v("在 Macos 上共享文件夹给虚拟机中的 CentOS, 即使 CentOS 在这个文件夹中有读写权限，也是无法创建硬链接的。反过来也一样，但是软链接是可以的。问题在于文件系统不一样。")])])}),[],!1,null,null,null);t.default=e.exports}}]);